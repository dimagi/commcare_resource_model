buffer: 0.2

usage:
  users:
    model: 'date_range_value'
    ranges:
      - ['20180101', '20181201', 700000]
      - ['20190101', '20191201', 1100000]
      - ['20200101', '20201201', 1400000]
  forms:
    model: 'derived_factor'
    dependant_field: 'users'
    factor: 600
  forms_total:
    model: 'cumulative'
    dependant_field: 'forms'
  cases:
    model: 'derived_factor'
    dependant_field: 'users'
    factor: 200
  cases_total:
    model: 'cumulative'
    dependant_field: 'cases'
  case_transactions:
    model: 'derived_factor'
    dependant_field: 'users'
    factor: 1600
  case_transactions_total:
    model: 'cumulative'
    dependant_field: 'case_transactions'
  task_cases:
    model: 'derived_factor'
    dependant_field: 'users'
    factor: 100
  task_cases_total:
    model: 'cumulative_limited_lifespan'
    dependant_field: 'task_cases'
    lifespan: 1
  phone_numbers:  # each user has a fixed number of person cases and each case has 1 phone number
    model: 'derived_factor'
    dependant_field: 'users'
    factor: 1500
  task_ledgers:
    model: 'derived_factor'
    dependant_field: 'task_cases'
    factor: 5
  task_ledger_updates:
    model: 'derived_factor'
    dependant_field: 'task_cases'
    factor: 4
  synclogs:
    model: 'derived_factor'
    dependant_field: 'users'
    factor: 10
  device_logs:
    model: 'derived_factor'
    dependant_field: 'users'
    factor: 1600
  device_logs_total:
    model: 'cumulative_limited_lifespan'
    dependant_field: 'device_logs'
    lifespan: 1
  images:
    model: 'derived_factor'
    dependant_field: 'users'
    factor: 33
  images_total:
    model: 'cumulative_limited_lifespan'
    dependant_field: 'images'
    lifespan: 3
  case_indices:
    model: 'derived_factor'
    dependant_field: 'cases_total'
    factor: 0.92
  kafak_changes:
    model: 'derived_sum'
    dependant_fields: ['forms', 'cases', 'case_transactions', 'task_ledger_updates']

storage:
  sql_primary:
    ssd: True
    redundancy_factor: 2
    data_models:  
      - referenced_field: 'forms_total'
        unit_bytes: 1200
      - referenced_field: 'cases_total'
        unit_bytes: 1800
      - referenced_field: 'case_indices'
        unit_bytes: 380
      - referenced_field: 'case_transactions_total'
        unit_bytes: 515
      - referenced_field: 'task_ledgers'
        unit_bytes: 450
      - referenced_field: 'task_ledger_updates'
        unit_bytes: 420
  device_logs:
    ssd: False
    redundancy_factor: 1
    data_models:
      - referenced_field: 'device_logs_total'
        unit_bytes: 1200
  sql_meta:
    ssd: True
    redundancy_factor: 2
    static_baseline: 20000000000  # 20GB to account for other static tables
    data_models:
      - referenced_field: 'phone_numbers'
        unit_bytes: 660
  couchdb_synclogs:
    ssd: True
    redundancy_factor: 2
    data_models:
      - referenced_field: 'synclogs'
        unit_bytes: 500000  # tries to take into account DB bloat
  couchdb_meta:
    ssd: True
    redundancy_factor: 3
    static_baseline: 20000000000  # 20GB to account for other databases
    data_models:
      - referenced_field: 'users'
        unit_bytes: 600000   # disk size / doc count of icds @ 2017-12-13
  elastic:
    ssd: False
    redundancy_factor: 2
    data_models:
      - referenced_field: 'forms_total'
        unit_bytes: 5500
      - referenced_field: 'cases_total'
        unit_bytes: 1800
      - referenced_field: 'case_transactions_total'
        unit_bytes: 250
      - referenced_field: 'task_ledgers'
        unit_bytes: 500  # TODO: get mor accurate number
  kafka:
    ssd: False
    redundancy_factor: 1
    data_models:
      - referenced_field: 'kafak_changes'
        unit_bytes: 500
  riak:
    ssd: False
    redundancy_factor: 3
    data_models:
      - referenced_field: 'forms_total'
        unit_bytes: 11000
      - referenced_field: 'images_total'
        unit_bytes: 50000
#  ucr:  # TODO
#  warehouse:  # TODO

compute:
  pillowtop:
    cores_per_vm: 4
    ram_per_vm: 6
    cores_per_process: 0.5
    ram_per_process: 0.7
    processes:
      - name: 'static-cases'
        user_capacity: 1875
      - name: 'static-person-cases'
        user_capacity: 5625
  django:
    cores_per_vm: 4
    ram_per_vm: 6
    processes:
      - user_capacity: 5000
